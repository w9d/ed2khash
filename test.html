
<div style="padding: 10px; border: 1px solid #ccc;">
<input type="file" id="files" name="_files[]" multiple /><br />
<button id="reset" name="reset_files" disabled="true">Reset</button>
<button id="process" name="process_files" disabled="true">Process</button>
</div>
<output id="list"></output>

<script>
  var files = new Array();

  function handleFileSelect(evt) {
    var _files = evt.target.files; // FileList object
    
    // files is a FileList of File objects. List some properties.
    var output = [];
    
    for (var i = 0, f; f = _files[i]; i++) {
      files.push(f);
    }
    for (var i = 0, f; f = files[i]; i++) {
      output.push('<li><strong>', escape(f.name), '</strong> (', f.type || 'n/a', ') - ',
                  f.size, ' bytes, last modified: ',
                  f.lastModified ? new Date(f.lastModified).toISOString() : 'n/a',
                  '</li>');
    }

    document.getElementById('list').innerHTML = '<ul>' + output.join('') + '</ul>';
    document.getElementById('reset').disabled = false;
    document.getElementById('process').disabled = false;
  }
  
  function resetEverything(evt) {
    files = new Array();
    document.getElementById('list').innerHTML = '';
    document.getElementById('files').value = '';
    document.getElementById('reset').disabled = true;
  }
  
  function processFiles(evt) {
    for (var i = 0, f; f = files[i]; i++) {
      var file = new FileReader();
      
      file.readAsArrayBuffer(f);
      file.addEventListener('loadend', printFileDetails, false);
    }
  }
  
  function printFileDetails(evt) {
    var chunks = evt.total / 9728000;
    var workers = givePowerOfTwo(navigator.hardwareConcurrency || 2);
    var blocksize = Math.floor(chunks) / workers * 9728000;
    //var firsttwo = evt.target.result.slice(0,1);
    //var nexttwo = evt.target.result.slice(1,2);
    //console.log('name=',escape(f.name),'size=',f.size,'result=',file.result);
    //console.log(evt);
    //var firstview = new Uint8Array(firsttwo);
    if (chunks > 1) {
      // multiwork begin
      if (workers > chunks) {
        workers = chunks;
        blocksize = Math.floor(chunks) / workers * 9728000;
      }
    } else {
      // single md4 begin
      workers = 1;
      blocksize = evt.total;
    }
    console.log('chunks=',chunks,'workers=',workers,'blocksize=',blocksize);
  }
  
  function powerOfTwo(x) {
    return (x != 0) && ((x & (x - 1)) == 0);
  }
  
  function givePowerOfTwo(x) {
    console.log('givePowerOfTwo:', x);
    if (!(x <= 1) && !powerOfTwo(x))
      return givePowerOfTwo(x - 1);
    else if (x <= 1)
      return 1;
    else
      return x;
  }

  document.getElementById('files').addEventListener('change', handleFileSelect, false);
  document.getElementById('reset').addEventListener('click', resetEverything, false);
  document.getElementById('process').addEventListener('click', processFiles, false);
</script>
